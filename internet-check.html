<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Internet Status Monitor</title>
  <style>
    body {
      margin: 0;
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: black;
      color: #0f0;
      font-family: Arial, sans-serif;
      text-align: center;
      overflow: hidden;
    }
    #matrix, #static {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      pointer-events: none;
    }
    #time {
      font-size: 8em;
      font-weight: bold;
      margin-top: 20px;
    }
    #status {
      font-size: 6em;
      font-weight: bold;
      margin-top: 10px;
    }
    #nextCheck {
      font-size: 1.5em;
      margin-top: 15px;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>
  <canvas id="matrix"></canvas>
  <canvas id="static"></canvas>
  <div id="time"></div>
  <div id="status">Checking...</div>
  <div id="nextCheck"></div>

  <!-- Hidden looping video -->
  <video id="keepAwakeVideo" playsinline muted loop style="display:none; width:1px; height:1px;">
    <source src="data:video/mp4;base64,AAAAHGZ0eXBNNA==" type="video/mp4">
  </video>

  <script>
    const statusDiv = document.getElementById('status');
    const timeDiv = document.getElementById('time');
    const nextCheckDiv = document.getElementById('nextCheck');
    const matrix = document.getElementById("matrix");
    const ctx = matrix.getContext("2d");
    const staticCanvas = document.getElementById("static");
    const staticCtx = staticCanvas.getContext("2d");
    const video = document.getElementById("keepAwakeVideo");

    matrix.height = window.innerHeight;
    matrix.width = window.innerWidth;
    staticCanvas.width = window.innerWidth;
    staticCanvas.height = window.innerHeight;

    const letters = "アァイィウヴエェオカガキギクグケゲコゴサザシジスズセゼソゾタダチッヂツヅテデトドナニヌネノハバパヒビピフブプヘベペホボポマミムメモヤユヨラリルレロワヲン";
    const fontSize = 14;
    const columns = matrix.width / fontSize;
    const drops = Array.from({length: columns}).map(() => 1);

    function drawMatrix() {
      ctx.fillStyle = "rgba(0, 0, 0, 0.05)";
      ctx.fillRect(0, 0, matrix.width, matrix.height);
      ctx.fillStyle = "#0f0";
      ctx.font = fontSize + "px monospace";
      for (let i = 0; i < drops.length; i++) {
        const text = letters[Math.floor(Math.random() * letters.length)];
        ctx.fillText(text, i * fontSize, drops[i] * fontSize);
        if (drops[i] * fontSize > matrix.height && Math.random() > 0.975) {
          drops[i] = 0;
        }
        drops[i]++;
      }
    }

    function drawStatic() {
      const imageData = staticCtx.createImageData(staticCanvas.width, staticCanvas.height);
      for (let i = 0; i < imageData.data.length; i += 4) {
        const shade = Math.random() * 255;
        imageData.data[i] = shade;
        imageData.data[i + 1] = shade;
        imageData.data[i + 2] = shade;
        imageData.data[i + 3] = 255;
      }
      staticCtx.putImageData(imageData, 0, 0);
    }

    function showMatrix() {
      matrix.style.display = "block";
      staticCanvas.style.display = "none";
    }
    function showStatic() {
      staticCanvas.style.display = "block";
      matrix.style.display = "none";
    }

    function updateClock() {
      const now = new Date();
      timeDiv.textContent = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
    }

    let countdown = 10;
    function updateCountdown() {
      nextCheckDiv.textContent = `Next check in ${countdown}s`;
      countdown--;
      if (countdown < 0) {
        countdown = 10;
        checkConnection();
      }
    }

    async function checkConnection() {
      statusDiv.textContent = "Checking...";
      try {
        const response = await fetch("https://www.google.com/favicon.ico?_=" + Date.now(), {mode: "no-cors"});
        if (response) {
          statusDiv.textContent = "✅ ONLINE";
          statusDiv.style.color = "#0f0";
          showMatrix();
        }
      } catch (e) {
        statusDiv.textContent = "OFFLINE";
        statusDiv.style.color = "#f00";
        showStatic();
      }
    }

    // Update clock
    setInterval(updateClock, 1000);
    updateClock();

    // Countdown timer
    setInterval(updateCountdown, 1000);

    // Matrix & static animation
    setInterval(drawMatrix, 50);
    setInterval(drawStatic, 100);

    // First connection check
    checkConnection();

    // Wake-lock video tap
    let wakeEnabled = false;
    document.body.addEventListener("click", () => {
      if (!wakeEnabled) {
        video.play().then(() => {
          wakeEnabled = true;
          alert("✅ Keep-awake mode is now ON");
          console.log("Keep-awake video started");
        }).catch(err => {
          alert("⚠️ Could not enable keep-awake: " + err);
          console.error(err);
        });
      } else {
        alert("ℹ️ Keep-awake mode already active");
      }
    });
  </script>
</body>
</html>

